.admin-card-wide.mdl-card.mdl-shadow--2dp
  table.mdl-data-table.within-card.sortable
    thead
      tr
        th.table-sortable-field #
        th.mdl-data-table__cell--non-numeric Name
        th Price (edit)
        th Alcohol
        th Hidden

    tbody
      - @items.each do |station_product|
        tr data-id="#{station_product.id}" class="#{'resource-hidden' if station_product.hidden?}"
          td.table-sortable-field = fa_icon("bars")
          td.mdl-data-table__cell--non-numeric
            = link_to station_product.product.name, [:admins, @current_event, station_product.product]
            .table-action
              = link_to admins_event_station_station_item_path(@current_event, @station, station_product, item_type: "station_product"), method: :delete, data: { confirm: t("alerts.confirm_delete") } do
                button.icon.material-icons id ="delete_#{@station.id}" delete
          td = best_in_place station_product, :price, as: :input, url: admins_event_station_station_item_path(@current_event, station_product.station, station_product, item_type: "station_product")
          td = best_in_place station_product.product, :is_alcohol, best_in_place_checkbox(admins_event_product_path(@current_event, station_product.product))
          td = best_in_place station_product, :hidden, best_in_place_checkbox(admins_event_station_station_item_path(@current_event, station_product.station, station_product, item_type: "station_product"))


javascript:
  function setPositions() {
    $('.sortable tr').each(function(i) {
        $(this).attr("data-pos", i + 1);
    });
  }

  function sortPosition() {
    setPositions();
    $('.sortable').sortable({
      items: 'tr' ,
      placeholder: '<tr><td class="sortable-placeholder" colspan="6">&nbsp;</td></tr>',
      handle: '.table-sortable-field i'
    });
    $('.sortable').sortable().bind('sortupdate', function(e, ui) {
        updated_order = [];
        setPositions();

        $('.sortable tr').each(function(i){
            updated_order.push({ id: $(this).data("id"), position: i + 1 });
        });


        $.ajax({
            type: "PUT",
            url: "#{sort_admins_event_station_station_items_path(@current_event, @station, item_type: 'station_product')}",
            data: { order: updated_order }
        });
    });
  }

  $(document).ready(sortPosition);
  $(document).on('turbolinks:load', sortPosition);
