$('#paymentForm').html('<%= j(render "#{current_event.payment_service}_payment_form").html_safe %>');
$('.container-order-buttons input[type="submit"]').hide();

if( $("#stripe-payment-form").length > 0 ) {
  var stripeResponseHandler = function(status, response) {
    var $form = $('#stripe-payment-form');
    if (response.error) {
      $form.find('.payment-errors').text(response.error.message);
      $form.find("input[type=submit]").prop('disabled', false);
    }
    else {
      var token = response.id;
      $form.append($('<input type="hidden" name="stripeToken" />').val(token));
      $form.get(0).submit();
    }
  };

  $("#stripe-payment-form").on("submit", function(event) {
    event.stopPropagation();
    event.preventDefault();
    var $form = $(this);
    $form.find("input[type=submit]").prop("disabled", true);
    Stripe.setPublishableKey($("#stripe-payment-form").data("p-key"));
    Stripe.card.createToken($form, stripeResponseHandler);
    return false;
  });
}