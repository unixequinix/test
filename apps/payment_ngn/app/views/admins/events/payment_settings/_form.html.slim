= simple_form_for @payment_settings_form, html: { :"data-p-key" => Rails.application.secrets.stripe_platform_publishable },
  url: admins_event_payment_settings_path(event_id: @event.id), method: :post do |f|
  fieldset
    h3.section-header
      = fa_icon "info-circle"
      = t("admin.event.fieldests.info")
    - @payment_settings_form.attributes.keys.each do |parameter|
      = f.input parameter
    = f.input :event_id, as: :hidden, input_html: { value: @event.id }

  .wrapper-negative-space
    = f.button :submit, t('admin.actions.update'), class: "btn btn-primary"


script src="https://js.stripe.com/v2/" type="text/javascript"

javascript:
  var stripeResponseHandler = function(status, response) {
    var $form = $('#new_stripe_payment_settings_form');
    if (response.error) {
      $form.find('.payment-errors').text(response.error.message);
      $form.find("input[type=submit]").prop('disabled', false);
    }
    else {
      var token = response.id;
      $form.append($('<input type="hidden" name="bankAccountToken" />').val(token));
      $form.get(0).submit();
    }
  };

  $("#new_stripe_payment_settings_form").on("submit", function(event) {
    event.stopPropagation();
    event.preventDefault();
    var $form = $(this);
    $form.find("input[type=submit]").prop("disabled", true);
    Stripe.setPublishableKey($("#new_stripe_payment_settings_form").data("p-key"));
    debugger;
    Stripe.bankAccount.createToken({
      country: $('#stripe_payment_settings_form_country').val(),
      currency: $('#stripe_payment_settings_form_currency').val(),
      routing_number: $('#stripe_payment_settings_form_routing_number').val(),
      account_number: $('#stripe_payment_settings_form_bank_account').val()
    }, stripeResponseHandler);
    return false;
  });